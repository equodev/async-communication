var EquoCommService;(()=>{"use strict";var e={d:(o,r)=>{for(var n in r)e.o(r,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:r[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)},o={};(()=>{var r,n;e.d(o,{EquoCommService:()=>s}),function(e){const o=window;function r(e){o[e.id]||(o[e.id]=e.service)}e.get=function(e,n){const t=o[e];if(!t&&null!=n){const o=n();if(!o)throw new Error(`${e} couldn't be created`);return r(o),o.service}if(t)return t;throw new Error(`${e} has not been installed`)},e.install=r}(r||(r={})),function(e){for(var o=[],r=0;r<256;r++)o[r]=(r<16?"0":"")+r.toString(16);e.getUuid=function(){var e=4294967296*Math.random()>>>0,r=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0,t=4294967296*Math.random()>>>0;return o[255&e]+o[e>>8&255]+o[e>>16&255]+o[e>>24&255]+"-"+o[255&r]+o[r>>8&255]+"-"+o[r>>16&15|64]+o[r>>24&255]+"-"+o[63&n|128]+o[n>>8&255]+"-"+o[n>>16&255]+o[n>>24&255]+o[255&t]+o[t>>8&255]+o[t>>16&255]+o[t>>24&255]}}(n||(n={}));class t{constructor(e){this.userEventCallbacks=new Map,this.ws=this.getWebSocketIfExists(e),void 0===this.ws&&(window.equoReceiveMessage=e=>{this.receiveMessage(e)})}getWebSocketIfExists(e){if(void 0!==e){if(void 0!==this.ws&&this.ws.readyState!==WebSocket.CLOSED)return this.ws;var o=new WebSocket(`ws://127.0.0.1:${e}`);return o.onopen=e=>{},o.onclose=()=>{},o.onmessage=e=>{this.receiveMessage(e.data)},o}}receiveMessage(e){var o,r=this.processMessage(e);if(r){var n=r.actionId;if(this.userEventCallbacks.has(n)){var t=this.userEventCallbacks.get(r.actionId);if((null===(o=null==t?void 0:t.args)||void 0===o?void 0:o.once)&&this.userEventCallbacks.delete(n),void 0===r.error)if(void 0!==r.callbackId)try{var i=null==t?void 0:t.onSuccess(r.payload);this.sendToJava({actionId:r.callbackId,payload:i})}catch(e){if("string"==typeof e)this.sendToJava({actionId:r.callbackId,error:e});else if(void 0!==e){const o=JSON.stringify(e);this.sendToJava({actionId:r.callbackId,error:o})}}else null==t||t.onSuccess(r.payload);else void 0!==r.error&&(null==t?void 0:t.onError)&&t.onError(r.error)}}}processMessage(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){return console.error(e),null}}sendToJava(e,o){var r,n=JSON.stringify({actionId:e.actionId,payload:e.payload,error:e.error,callbackId:null==o?void 0:o.id});void 0!==window.equoSend?window.equoSend({request:n,onSuccess:e=>{var r;try{r=JSON.parse(e)}catch(o){r=e}null==o||o.onSuccess(r)},onFailure:(e,r)=>{void 0!==(null==o?void 0:o.onError)&&o.onError({code:e,message:r})},persistent:!(null===(r=null==o?void 0:o.args)||void 0===r?void 0:r.once)}):void 0!==this.ws&&this.waitForCommConnection(this,(()=>{var e;null===(e=this.ws)||void 0===e||e.send(n)}))}waitForCommConnection(e,o){setTimeout((()=>{void 0!==this.ws&&(this.ws.readyState===WebSocket.OPEN?null!=o&&o():e.waitForCommConnection(e,o))}),5)}send(e,o){return r=this,t=void 0,s=function*(){return yield new Promise(((r,t)=>{var i={actionId:e,payload:o},s={onSuccess:r,onError:t,args:{once:!0}};void 0!==this.ws&&(s.id=n.getUuid(),this.on(s.id,r,t,s.args)),this.sendToJava(i,s)}))},new((i=void 0)||(i=Promise))((function(e,o){function n(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(o){var r;o.done?e(o.value):(r=o.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,a)}c((s=s.apply(r,t||[])).next())}));var r,t,i,s}on(e,o,r,n){var t={onSuccess:o,onError:r,args:n};this.userEventCallbacks.set(e,t)}}const i="equo-comm",s=r.get(i,(function(){var e;if(void 0===window.equoSend){const o=new URLSearchParams(window.location.search).get("equocommport");e=null===o?void 0:+o}return{id:i,service:new t(e)}}))})(),EquoCommService=o.EquoCommService})();