var EquoCommService;(()=>{"use strict";var e={d:(o,n)=>{for(var t in n)e.o(n,t)&&!e.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:n[t]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)},o={};(()=>{var n,t;e.d(o,{EquoCommService:()=>s}),function(e){const o=window;function n(e){o[e.id]||(o[e.id]=e.service)}e.get=function(e,t){const r=o[e];if(!r&&null!=t){const o=t();if(!o)throw new Error(`${e} couldn't be created`);return n(o),o.service}if(r)return r;throw new Error(`${e} has not been installed`)},e.install=n}(n||(n={})),function(e){for(var o=[],n=0;n<256;n++)o[n]=(n<16?"0":"")+n.toString(16);e.getUuid=function(){var e=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0,t=4294967296*Math.random()>>>0,r=4294967296*Math.random()>>>0;return o[255&e]+o[e>>8&255]+o[e>>16&255]+o[e>>24&255]+"-"+o[255&n]+o[n>>8&255]+"-"+o[n>>16&15|64]+o[n>>24&255]+"-"+o[63&t|128]+o[t>>8&255]+"-"+o[t>>16&255]+o[t>>24&255]+o[255&r]+o[r>>8&255]+o[r>>16&255]+o[r>>24&255]}}(t||(t={}));class r{constructor(e){this.userEventCallbacks=new Map,this.ws=this.getWebSocketIfExists(e),void 0===this.ws&&(window.equoReceiveMessage=e=>{this.receiveMessage(e)})}getWebSocketIfExists(e){if(void 0!==e){if(void 0!==this.ws&&this.ws.readyState!==WebSocket.CLOSED)return this.ws;var o=new WebSocket(`ws://127.0.0.1:${e}`);return o.onopen=e=>{},o.onclose=()=>{},o.onmessage=e=>{this.receiveMessage(e.data)},o}}receiveMessage(e){var o,n=this.processMessage(e);if(n){var t=n.actionId;if(this.userEventCallbacks.has(t)){var r=this.userEventCallbacks.get(n.actionId);if((null===(o=null==r?void 0:r.args)||void 0===o?void 0:o.once)&&this.userEventCallbacks.delete(t),void 0===n.success||n.success){var i=null==r?void 0:r.onSuccess(n.payload);void 0!==n.callbackId&&this.sendToJava({actionId:n.callbackId,payload:i})}else(null==r?void 0:r.onError)&&void 0!==n.error&&r.onError(n.error)}}}processMessage(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}return null}sendToJava(e,o){var n,t,r=JSON.stringify({actionId:e.actionId,payload:e.payload,callbackId:null==o?void 0:o.id});void 0!==window.equoSend?window.equoSend({request:r,onSuccess:e=>{var n;try{n=JSON.parse(e)}catch(o){n=e}null==o||o.onSuccess(n)},onError:null!==(n=null==o?void 0:o.onError)&&void 0!==n?n:()=>{},persistent:!(null===(t=null==o?void 0:o.args)||void 0===t?void 0:t.once)}):void 0!==this.ws&&this.waitForCommConnection(this,(()=>{var e;null===(e=this.ws)||void 0===e||e.send(r)}))}waitForCommConnection(e,o){setTimeout((()=>{void 0!==this.ws&&(this.ws.readyState===WebSocket.OPEN?null!=o&&o():e.waitForCommConnection(e,o))}),5)}send(e,o){return n=this,r=void 0,s=function*(){return yield new Promise(((n,r)=>{var i={actionId:e,payload:o},s={onSuccess:n,onError:r,args:{once:!0}};void 0!==this.ws&&(s.id=t.getUuid(),this.on(s.id,n,r,s.args)),this.sendToJava(i,s)}))},new((i=void 0)||(i=Promise))((function(e,o){function t(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(o){var n;o.done?e(o.value):(n=o.value,n instanceof i?n:new i((function(e){e(n)}))).then(t,a)}c((s=s.apply(n,r||[])).next())}));var n,r,i,s}on(e,o,n,t){var r={onSuccess:o,onError:n,args:t};this.userEventCallbacks.set(e,r)}}const i="equo-comm",s=n.get(i,(function(){var e;if(void 0===window.equoSend){const o=new URLSearchParams(window.location.search).get("equocommport");e=null===o?void 0:+o}return{id:i,service:new r(e)}}))})(),EquoCommService=o.EquoCommService})();